<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            padding:16px;
        }
        h1, h2 {
            color: rgb(8, 101, 101);
        }
        ul li a {
            font-size: 1.2rem;
            text-decoration: none;
            color: azure;
            background-color: darkblue;
            padding:4px;
            border-radius: 8px;;
        }
        ul li {
            color: darkblue;
            padding:8px;
        }
    </style>
</head>
<body>
    <h1>Turinys</h1>
    <ul>
        <li>
            <a href="#NDexpress">Node Express sukūrimo instrukcija</a> 
        </li>
        <li>
            <a href="#react-express">Duomenų bazės sujungimo su React ir Node Express instrukcija</a>
        </li>
        <li>
            <a href="#irasu-pavaizdavimas">Duomenų bazės įrašų pavaizdavimas</a>
        </li>
        <li>
            <a href="#irasu-ivedimas">Įrašų įvedimo iš React į duomenų bazę instrukcija</a>
        </li>
            
            
            <a href="#NDexpress"></a>
       
    </ul>
    <h2 id="NDexpress">Node Express sukūrimo instrukcija</h2>
    <ol>
        <li>Reikia instaliuoti node (npm init, npm install), nodemon, mysql, cors<br>
            const express = require('express')<br>
            const mysql = require('mysql')<br>
            const cors = require('cors')
        </li>
        <li>Nurodoma naudoti express moduli ir portą:<br>
            const app = express()<br>
            const port = 3006<br>
        </li>
        <li>app.get grąžina turinį į užklausas, šiuo atveju į blank:<br>
            app.get('/', (req, res) => {<br>
              res.send('Hello World!')<br>
            })
        </li>
        <li>Įvedamas veikimo patikrinimas:<br>
            app.listen(port, () => { <br>
            console.log(`Example app listening at http://localhost:${port}`)<br>
            })
        </li>
        <li>Įvedami nustatymai sąsajai su duomenų baze (DB serveris tur būti paleistas)
            const sasaja = mysql.createConnection({ <br>
                host: "localhost",<br>
                user: "root",<br>
                database: "prekiu_krepselis",<br>
                password: "root" <br>
              });
        </li>
        <li>Sukuriama sąsaja su DB:<br>
            sasaja.connect(function(err) {<br>
                if (err) throw err;<br>
                console.log("Connected!");<br>
              });
        </li>
        <li> Aktyvuojamas cors:<br>
            app.use(cors());
        </li>
        <li>Ši komanda įgalina atpažinti siunčiamą infprmaciją kaip tekstą ar masyvą:<br>
            app.use(express.urlencoded({<br>
                extended: true<br>
                }))
        </li>
        <li>Nurodo automatiškai perskaityti JSON informaciją:<br>
            app.use(express.json());
        </li>
        <li>Patikrina JSON perskaitymo veikimą:<br>
            app.get('/JSONtest', (req, res) => { <br>
                res.send(JSON.stringify({JSONtest: 'Viskas OK'}))<br>
              })
        </li>
        <li>Prisijungimas prie konkrečios DB lentelės:<br>
            app.get('/prekes', (req, res) => {<br>
                const sqlUzklausa = `select * from prekes`<br>
                sasaja.query(sqlUzklausa, (err, results) =>{<br>
                if (err) {console.log("Klaida");throw err}<br>
                else {res.send(results)} <br>
                }) })
        </li>
    </ol>
    <h2 id="react-express">Duomenų bazės sujungimo su React ir Node Express instrukcija</h2>
    <ol>
        <li>Susikuriama duomenų bazė</li>
        <li>Susikuriamas React App.jsx</li>
        <li>Įdiegiama Axios biblioteka (galima naudoti JS Fetch API su JS)<br>su 'npm install axios'.<br>Įterpiamas į App.jsx su 'import axios from "axios"'.<br>Axios reikalingas React susijungimui su Express serveriu.</li>
        <li>Pasileidžiamas React serveris, po to pasleidžiamas Express serveris su Nodemon<br> Turi rodyti 'connected!'
        </li>
        <li>serverio .js byloje padaromas testinis JSON perdavimas:<br>' res.send(JSON.stringify({JSONtest: 'Viskas OK'}))'<br>Rezultatas patikrinamas su naršykle.<br>Dabar reikia, kad į šį perdavimą (aka routerį) kreiptųsi React</li>
        <li>useEffect naudojamas šiam kreipimuisi. Įvedamas į App.jsx funkcijos kūną.<br>
        Pirmas jo argumentas - funkcija, antras - tuščias masyvas, kuris rodo, kad useEffect bus aktyvuota vieną kartą.<br>
        Su axios krepiamasi į kitą serverį ir į konkretų puslapį.<br>
        Grąžinamas res.data yra tik duomenys, nes tik jų reikia.<br>
        useEffect( () => {<br>
            axios.get('http://localhost:3003/JSONtest')<br>
            .then (res => {<br>
                console.log(res.data)<br>
            })}, []) </li>
        <li>Po to reikalingi du 'powershell' terminalai.<br>
        Iš vieno pasileidžiamas React, iš kito - Express serveriai.</li>
        <li>Toliau sukuriame užklausą e-server.js į duomenų bazės lentelę 'zveris':</li>
        app.get('/zveris', (req, res) => {<br>
            const sqlUzklausa = `select * from zveris`</b>
            con.query(sqlUzklausa, (err, results) =>{<br>
            if (err) {console.log("Klaida");throw err}<br>
            else {res.send(results)}  }) })<br>
            Čia 'sqlUžklausa' yra kreipimosi turinys, o 'con.query' ją persiunčia, 'res.send' grąžina rezultatą.<br>
            Papildomai pasitikrinti 'con' aprašyme, ar nurodyta duomenų bazė ('zverincius' šiuo atveju).
        <li>Po to atitinkamai pakeičiamas kelias React serveryje:<br>axios.get('http://localhost:3003/zveris')</li>
        <li>Naršyklės 'Network' kortelėje galima matyti sąsajos procesus.</li>  
    </ol>
    <h2 id="irasu-pavaizdavimas">Duomenų bazės įrašų pavaizdavimas</h2>
    <ol>
        <li>Susikuriami komponentai, kuriuose formuojamas JSX vaizdas 'return' skiltyje:<br>
            export default function Table () {<br>
            return (<div></div>) }
        </li>
        <li>React App.jsx byloje importuojami komponentai:<br>
            import component from "./Components/component"
        </li>
        <li>Susikuriamos atitinkamų komponentų CSS bylos
        </li>
        <li>Komponento funkcijos argumente iš duomenų bazės imamas kintamasis nurodomas kaip savybė (aka propsas):<br>
        function TableRow ( {item} )
        </li>
        <li>Po to propso elementai sukeliami į jų vietas JSX'e:<br>
            div{item.kaina}div
        </li>
        <li>Sukurūs vieną komponentą jis gali būti padauginamas tėviname komponente imant įrašą iš DB ir naudojant .map metodą.<br>Tam reikia tėvinio komponento funkcijos argumente vėl nurodyti propsą (kito pav.).
        </li>
    </ol>
    <h2 id="irasu-ivedimas">Įrašų įvedimo iš React į duomenų bazę instrukcija</h2>
    <ol>
        <li>Kiekvienai įvesties vertei sukuriamas steitas (šiuo atveju, jų objektas) komponento jsx byloje:<br>const [vertes, setVertes] = useState( {} )</li>
        <li>Po to sukuriama kontrolės funkcija:<br>
            const formControl = (e, what) => {<br>
                const vertesCopy = {...vertes};<br>
                vertesCopy[what] = e.target.value;<br>
                setVertes (vertesCopy);}</li>  
        <li>Toliau sukuriamas pačios formos HTML'as:<br>
            <input type="text" value={vertes["Vardas"]} onChange={(e) => formControl(e, "Vardas")} required /></li> 
        <li>App.jsx byloje susikuriama funkcija, kuri pasiųs naujus duomenis į duomenų bazės lentelę.<br>
            const sukurti = vertes => {<br>
                axios.post('http://localhost:3003/zveris', vertes)<br>
                .then (res => {<br>
                    setAtnaujinti(Date.now());<br>
                    console.log(res.data) }) }</li>
        <li>
            
        </li>
    </ol>
</body>
</html>